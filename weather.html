<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test AJAX</title>
	<link rel = "stylesheet" type = "text/css" href="weather.css"/>
	<link rel = "stylesheet" type = "text/css" href="bootstrap.css"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script>
      function uneFonction(ville) {
		 var s="";
		 console.log(ville);
		 $(ville).find("current").children().each(function(){
			 s += "<span class='title'>" + this.nodeName.toUpperCase() + "</span> ";
			 $.each(this.attributes, function(i, attrib){
				if(!(attrib.name=='value' || attrib.name=='unit'|| attrib.name=='name')){
					s += attrib.name + " : ";
				}
				s += attrib.value +" ";
			 });
			 $(this).children().each(function(){
			  s += "<span class='subtitle'>" + this.nodeName + "</span> ";
			   $.each(this.attributes, function(i, attrib){
				   if(!(attrib.name=='value' || attrib.name=='unit' || attrib.name=='name')){
						s += attrib.name + " : ";
					}
				s += attrib.value +" ";
			   });
			 });
			 s+= "<br/>";
		 });
		$("#result").html(s);
      }

      function appelWeather() {
        var s = "http://api.openweathermap.org/data/2.5/weather";
        $.ajax({ url: s,
				data: {q : $("#lieu").val(), appid : "c16040d55161808f22ac7d3ef7959a5e", lang : "fr", mode:"xml"},
                 dataType: "xml",
				 type: "GET",
                 success: uneFonction,
                 error: traiteErreur });
      }
      
      function traiteErreur(jqXHR, textStatus, errorThrown) {
        alert("Erreur " + errorThrown + " : " + textStatus);
      }
	  
	  $(window).load(appelWeather);

    </script>
  </head>
  <body>
    <div class="container">
		<h1>Appli M&eacutet&eacuteo</h1>
		<div class="container">
			<div class="row">
				<div class="col-xs-8">
					<h3>Choisissez votre ville !</h3><br/>
				</div>
				<div class="col-xs-4">
					<img src="photo-soleil.png" alt="soleil" style="height:80px"/>
				</div>
			</div>
			<div class="row">
				<form id="searchbox">
				  <input type="text" maxlength="80" value="London,uk" id="lieu">
				  <input type="submit" value="Rechercher" onClick="appelWeather();return false;">
				</form>
			</div>
		</div>
		<br/>
		<p id="result"></p>
	</div>
  </body>
</html>
